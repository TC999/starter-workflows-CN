# æ­¤å·¥ä½œæµä½¿ç”¨ GitHub æœªè®¤è¯çš„æ“ä½œã€‚è¿™äº›æ“ä½œç”±ç¬¬ä¸‰æ–¹æä¾›ï¼Œå¹¶å—ç‹¬ç«‹çš„æœåŠ¡æ¡æ¬¾ã€éšç§æ”¿ç­–å’Œæ”¯æŒæ–‡æ¡£çº¦æŸã€‚
#
# ğŸ¦… STACKHAWK        https://stackhawk.com
#
# StackHawk HawkScan æ“ä½œä½¿å°†åŠ¨æ€åº”ç”¨ç¨‹åºå®‰å…¨æµ‹è¯• (DAST) é›†æˆåˆ° CI æµæ°´çº¿ä¸­å˜å¾—è½»æ¾ã€‚è¯·æŸ¥çœ‹å…¥é—¨æŒ‡å—ï¼ˆhttps://docs.stackhawk.com/hawkscan/ï¼‰ï¼Œ
# ä»¥å¿«é€Ÿäº†è§£å¦‚ä½•ä½¿ç”¨ StackHawkã€‚
#
# è¦ä½¿ç”¨æ­¤å·¥ä½œæµï¼Œæ‚¨å¿…é¡»ï¼š
#
# 1. åˆ›å»º API å¯†é’¥å’Œåº”ç”¨ç¨‹åºï¼šåœ¨ https://app.stackhawk.com æ³¨å†Œä¸€ä¸ªå…è´¹çš„ StackHawk å¸æˆ·ä»¥è·å– API å¯†é’¥ï¼Œ
#    å¹¶åœ¨è¯¥ç«™ç‚¹åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åºå’Œé…ç½®æ–‡ä»¶ã€‚
#
# 2. å°† API å¯†é’¥ä¿å­˜ä¸º Secretï¼šå°†æ‚¨çš„ API å¯†é’¥ä¿å­˜ä¸ºåä¸º HAWK_API_KEY çš„ GitHub Secretã€‚
#
# 3. æ·»åŠ é…ç½®æ–‡ä»¶ï¼šå°†æ‚¨çš„ stackhawk.yml é…ç½®æ–‡ä»¶æ·»åŠ åˆ°å­˜å‚¨åº“ç›®å½•çš„åŸºç¡€ç›®å½•ä¸­ã€‚
#
# 4. è®¾ç½®æ‰«æå¤±è´¥é˜ˆå€¼ï¼šå°† hawk.failureThreshold é…ç½®é€‰é¡¹
#    (https://docs.stackhawk.com/hawkscan/configuration/#hawk) æ·»åŠ åˆ° stackhawk.yml é…ç½®æ–‡ä»¶ä¸­ã€‚
#    å¦‚æœæ‰«æäº§ç”Ÿçš„è­¦æŠ¥è¾¾åˆ°æˆ–è¶…è¿‡ hawk.failureThreshold è­¦æŠ¥çº§åˆ«ï¼Œåˆ™æ‰«æå°†è¿”å›é€€å‡ºä»£ç  42ï¼Œ
#    å¹¶è§¦å‘ä¸€ä¸ªå¸¦æœ‰æŒ‡å‘æ‰«æç»“æœçš„ Code Scanning è­¦æŠ¥çš„é“¾æ¥ã€‚
#
# 5. æ›´æ–° "Start your service" æ­¥éª¤ï¼šæ›´æ–°ä¸‹é¢ StackHawk å·¥ä½œæµç¨‹ä¸­çš„ "Start your service" æ­¥éª¤ï¼Œ
#    ä»¥å¯åŠ¨æ‚¨çš„æœåŠ¡ï¼Œä»¥ä¾¿å®ƒå¯ä»¥åœ¨ "Run HawkScan" æ­¥éª¤ä¸­è¿›è¡Œæ‰«æã€‚

name: "StackHawk"

on:
  push:
    branches: [ $default-branch, $protected-branches ]
  pull_request:
    branches: [ $default-branch ]
  schedule:
    - cron: $cron-weekly

permissions:
  contents: read

jobs:
  stackhawk:
    permissions:
      contents: read # ç”¨äº actions/checkout æ‹‰å–ä»£ç 
      security-events: write # ç”¨äº stackhawk/hawkscan-action ä¸Šä¼ ä»£ç æ‰«æè­¦æŠ¥ä¿¡æ¯
    name: StackHawk
    runs-on: ubuntu-20.04
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3

      - name: å¯åŠ¨æ‚¨çš„æœåŠ¡
        run: ./your-service.sh &                  # âœï¸ æ›´æ–°æ­¤é¡¹ä»¥è¿è¡Œæ‚¨è‡ªå·±çš„è¦è¿›è¡Œæ‰«æçš„æœåŠ¡

      - name: è¿è¡Œ HawkScan
        uses: stackhawk/hawkscan-action@4c3258cd62248dac6d9fe91dd8d45928c697dee0
        continue-on-error: true                   # âœï¸ å°†å…¶è®¾ç½®ä¸º falseï¼Œä»¥åœ¨æ‰«æé”™è¯¯æ—¶ä¸­æ–­æ„å»º
        with:
          apiKey: ${{ secrets.HAWK_API_KEY }}
          codeScanningAlerts: true
          githubToken: ${{ github.token }}
